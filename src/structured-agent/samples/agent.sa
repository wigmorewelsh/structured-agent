extern fn receive(): String

extern fn read_file(path: String): String
extern fn write_file(path: String, content: String): ()

fn complete(): () {
    return ()
}

fn handle_read_file(content: String): () {
    content!

    return agent_loop()
}

fn agent_loop(): () {
    "if the current task is complete, exit"!
    select {
        write_file(_, _) as r => agent_loop(),
        read_file(_) as r => handle_read_file(r),
        complete() as r => r
    }
}

fn main(): () {
    let task = "read the file called test.tmp"
    task!

    agent_loop()
}
